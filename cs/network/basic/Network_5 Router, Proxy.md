### Router

라우터도 컴퓨터다. & 호스트다.

라우터에도 IP 주소를 부여한다.

라우터에 연결된 인터페이스가 2개 -> NIC 카드 2개 들어있다.

라우터가 처리할 수 있는 곳
1. 프로세스 수준
2. 커널모드에서 IP 수준
3. 하드웨어 수준(NIC 수준)

아래로 갈수록 빠르다.

---

만약 라우터에 보안 역할이 추가되면  
(패킷을 어떤 기준에 따라 bypass 하거나 drop 하면)

이것은 패킷 필터링 방화벽이 된다.

(라우터와 패킷 필터랑 방화벽은 구조가 유사하다)

---

### Inline 구조  

패킷을 통과(Bypass)시키거나 차단(Drop)하는 구조

### Out of Path 구조

패킷을 감지하는 것이 목적  
(지나가는 모든 패킷을 카피함(포트 미러링) - 이 정보는 read-only)  

패킷을 분석하거나 기록하기 위해 사용되며 패킷에는 영향을 주지 않음

> 카피를 하는데 원본과 사본이 동일하면  
> 이것을 미러링이라 한다

이런 구조로 설치한 기기들은 Sensor일 가능성이 높다.

out of path 구조의 요소는 CPU 사용량이 매우 높다.

---

### Inline과 Out of path의 공통점  

둘다 다루는 데이터의 단위가 패킷이다.

---

## (Application)Proxy

클라이언트와 서버 사이에서 중개자 역할을 하는 서버

클라이언트가 서버에 직접 요청하는 대신에 프록시 서버에 요청을 보내면,  
프록시 서버가 대신 원격 서버에 요청을 전달하고 응답을 받은 후 클라이언트에게 반환

> inline, out of path와 proxy의 차이점
> 
> proxy는 Application Layer에서 동작한다.
> (위 두 방식은 패킷 단위로 다루는데, proxy는 스트림 단위로 다룬다)

### 프록시의 목적

`1. 우회`

클라이언트가 서버에 요청을 보낼때 마다, 프록시 서버를 거치기 때문에  
상대 서버에 요청이 도착했을 때, 요청을 보낸 컴퓨터는 프록시 서버 컴퓨터로 인식된다.

-> IP 주소를 우회 할 수 있다.

`2. 분석`

https 정보를 패킷 단위로 분석하기는 어렵다(암호화 되어 있으니까)

웹 수준인 프록시를 이용해서 데이터를 분석한다.  
(이 데이터는 평문(암호화 안되어 있음))

> fiddler를 이용해 내 소켓 통신을 분석할 수 있다.


`3. 감시와 보호`

프록시를 통해 다른 서버에 접속하기 때문에, 
해당 서버에 의해 악성코드에 감영이 되도, 감염되는것은 프록시 서버의 컴퓨터
따라서 기존 컴퓨터를 보호할 수 있다.

감시도 가능하다
프록시 서버의 컴퓨터를 관리자가 보고 있으면, 해당 프록시 서버를 통해,
내부망 컴퓨터들이 어디를 접속하는지 감시 가능

`4. 리버스 프록시`

웹서버가 활용하는 경우

이 프록시를 통해 외부에서 서버 컴퓨터에 접근하는 것이 불가능하게 된다.
(오직 프록시서버를 거쳐야 만 서버에 접속 가능)

이 프록시가 감시&보호 가능

그리고 로드 밸런싱 기능도 가능하다.

> 프록시 서버가 특정 클라이언트의 공격을 감지하여 차단하면,
> 이것은 WAF(Web Application Firewall)

---

### 스트림(소켓) 단위로 감시하는게 패킷 단위로 감시하는 것보다 좋은 이유

패킷은 MTU가 1500Byte - 너무 작다.  
(만약 파일을 보내면 일일이 해석하기 힘들 것이다)

프록시는 스트림 단위로 해석하기 때문에 그나마 편하다.