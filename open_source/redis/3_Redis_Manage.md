## 메모리 관리를 잘하자

> Redis는 In-memory 데이터베이스

만약 Physical Memory 이상을 사용하게 되면  
1. Swap이 있으면 에러는 나지 않지만 성능이 떨어진다.
2. Swap이 없으면 Out of Memory 에러가 발생한다.

Maxmemory 설정을 통해 메모리 사용량을 제한할 수 있다.

> 이렇게 설정하더라도, 이보다 더 사용할 가능성이 있다.
> 
> 왜냐하면  
> 페이지 단위로 메모리를 할당하기 때문에  
> 실제 사용량은 설정한 값보다 더 크게 사용할 수 있다.  
> (memory fragmentation)

### RSS 값을 모니터링하자

RSS: Resident Set Size  
(프로세스가 사용하는 실제 메모리 크기)

### 메모리 관리

큰 메모리를 사용햐는 인스턴스 1개보다  
작은 메모리를 사용하는 인스턴스 여러 개를 사용하는 것이 좋다.

헤비한 쓰기 작업을 진행할 때,  
copy-on-write를 사용하면서 메모리를 많이 사용한다고 한다.

> 대신 여러 인스턴스를 관리하는게 어렵다.

### 메모리를 줄이기 위한 설정 - ZipList

ZipList: 작은 크기의 List, Hash를 압축해서 저장하는 방식

> 기본적으로 Collection 들은 HashTable 등을 많이 사용하는데  
> 이들은 메모리를 많이 사용한다.

> In-memory 특성 상  
> 적은 개수는 선형 탐색을 하더라도 빠르다.

그래서 원소의 개수가 일정 개수 이하일 때는  
ZipList를 사용하도록 설정하자.

---

## O(N) 관련 명령은 주의하자

레디스는 Single Threaded이기 때문에  
O(N) 관련 명령을 사용하면 다른 명령들이 블로킹된다.

> O(N) 관련 명령은  
> `KEYS`, `FLUSHALL`, `FLUSHDB`, `GETALL` 등이 있다.

### `KEYS` 명령 대체 방법

`SCAN` 명령을 사용하자.

이 명령을 통해 하나의 긴 명령이  
짧은 여러 개의 명령으로 나눠진다.

> 이때 여러 개의 명령 사이에  
> 다른 명령들이 수행될 수 있다.

---

