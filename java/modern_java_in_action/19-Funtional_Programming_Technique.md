# 19 함수형 프로그래밍 기법

이 장에서는 함수형 프로그래밍 기법인, 고차원 함수, 커링, 영구 자료구조, 게으른 리스트, 패턴 매칭, 참조 투명성을 이용한 캐싱, 콤비네이터 등을 살펴본다.

## 19.1 함수는 모든 곳에 존재한다.

여기선 함수를 마치 일반값처럼 사용해서 인수로 전달하거나, 결과로 반환받거나, 자료구조에 저장할 수 있음을 의미한다.

일반값처럼 취급할 수 있는 함수를 `일급 함수`라고 한다. 

    자바 8에서는 :: 연산자로 메서드 참조를 만들거나 (int x) -> x+1 같은 람다 표현식으로 직접 함숫값을 표현해서 메서드를 함숫값으로 사용할 수 있다.

### 19.1.1 고차원 함수

Comparator.comparing처럼 다음 중 하나 이상의 동작을 수행하는 함수를 `고차원 함수`라 부른다.
- 하나 이상의 함수를 인수로 받음
- 함수를 결과로 받환

### 19.1.2 커링

다음 메서드를 보자

```java
static DoubleUnaryOperator curriedConverter(double f, double b){
    return (double x) -> x * f + b;
}
```

위 메서드에 변환 요소(f)와 기준치(b)만 넘겨주면 우리가 원하는 작업을 수행할 함수가 봔환된다.

다음처럼 변환기를 사용할 수 있다.

```java
double gbp = convertUSDtoGBP.applyAsDouble(1000);
```

결과적으로 기존의 변환 로직을 재활용하는 유연한 코드를 얻었다.

`커링의 이론적 정의`<br>
커링은 x와 y라는 두 인수를 받는 함수 f를 한 개의 인수를 받는 g라는 함수로 대체하는 기법이다.

f(x,y) = (g(x))(y)

이와 같은 여러 과정이 끝까지 완료되지 않은 상태를 가리켜 '함수가 부분적으로 적용되었다'라고 말한다.

## 19.2 영속 자료구조

함수형 프로그램에서는 함수형 자료구조, 불변 자료구조 등의 용어도 사용하지만 보통은 영속 자료구조라고 부른다. (DB의 영속과는 다른 의미)

영속이란 저장된 값이 다른 누군가에 의해 영향을 받지 않는 상태를 의미한다.

## 19.3 스트림과 게으른 평가

스트림은 단 한번만 소비할 수 있다는 제약이 있어서 스트림은 재귀적으로 정의할 수 없다.

이 절에서는 이와 같은 제약때문에 이상한 문제가 생길 수 있다.

이를 Lazy하게 처리하면 해결할 수 있다.

하지만 lazy한 실행으로 인한 오버헤드가 더 커질 수 있다.

lazy 자료구조는 강력한 프로그래밍 도구라는 사실을 기억하자. 애플리케이션을 구현하는 데 도움을 준다면 lazy 자료구조를 사용하자. 하지만 lazy 자료구조떄문에 효율성이 떨어진다면 전통적인 방식(eager)으로 코드로 구현하자.

## 19.4 패턴 매칭

f(0) = 1<br>
f(n) = n * f(n-1) // n > 0

위 형식이 패턴 매칭이다.

자바에서는 이를 if-then-else나 switch문을 사용해야 한다. 자료형이 복잡해지면서 이러한 작업을 처리하는데 필요한 코드의 양도 증가했다.

패턴 매칭을 사용하면 이러한 불필요한 잡동사니를 줄일 수 있다.

    자바에서는 이 기능을 지원하지 않는다.

## 19.5 기타 정보

### 19.5.1 캐싱 또는 기억화

`memoization`

참조 투명성 함수의 특징을 이용하는 기법이다. 

참조 투명성 함수는 같은 입력에 대해 항상 같은 아웃풋을 반환하기 때문에, 이 결과를 미리 저장해놓으면 성능을 올릴 수 있다.

### 19.5.2 '같은 객체를 반환함'은 무엇을 의미하는가?

참조 투명성이란 '인수가 같다면 결과도 같아야 한다'라는 규칙을 만족함을 의미한다.

하지만 객체를 반환할때는 주소값이 다르기 때문에, (t1 == t2)를 만족하지 않으므로 이 함수는 참조 투명성을 갖지 않는다고 결론내릴 수 있다.

그러나 자료구조를 변경하지 않는 상황에서 참조가 다르다는 것은 큰 의미가 없으며 t1과 t2가 논리적으로는 같다고 판단할 수 있다.

    일반적으로 함수형 프로그래밍에서는 데이터가 변경되지 않으므로 같다는 의미는 ==(참조가 같음)이 아니라 구조적인 값이 같다는 것을 의미한다.

### 19.5.3 콤비네이터

함수형 프로그래밍에서는 두 함수를 인수로 받아 다른 함수를 반환하는 등 함수를 조합하는 고차원 함수를 많이 사용하게 된다. 이처럼 함수를 조합하는 기능을 `콤비네이터`라고 부른다.

자바 8 API에 추가된 많은 기능은 콤비네이터의 영향을 많이 받았다.

    CompletableFuture 클래스의 thenCombine 메서드
    - CompletableFuture와 BiFunction 두 인수를 받아 새로운 CompletableFuture를 생성함

## 19.6 마치며

일급 함수란 인수로 전달하거나, 결과로 반환하거나, 자료구조에 저장할 수 있는 함수다.

고차원 함수란 한 개 이상의 함수를 인수로 받아서 다른 함수로 반환하는 함수다. 자바에서는 comparing, andThen, compose 등의 고차원 함수를 제공한다.

커링은 함수를 모듈화하고 코드를 재사용할 수 있도록 지원하는 기법이다.

영속 자료구조는 갱신될 때 기존 버전의 자신을 보존한다. 결과적으로 자신을 복사하는 과정이 따로 필요하지 않다.

자바의 스트림은 스스로 정의할 수 없다.

lazy 리스트는 자바 스트림보다 비싼 버전으로 간주될 수 있다. lazy 리스트는 데이터를 요청했을 때 Supplier를 이용해서 요소를 생성한다. Supplier는 자료구조의 요소를 생성하는 역할을 수행한다.

패턴 매칭은 자료형을 언랩하는 함수형 기능이다. 자바의 switch문을 일반화할 수 있다.

참조 투명성을 유지하는 상황에서는 계산 결과를 캐시할 수 있다.

콤비네이터는 둘 이상의 함수나 자료구조를 좋바하는 함수형 개념이다.