# 쿠키

클라이언트 측에서 저장하는 작은 데이터 조각  
클라이언트가 서버에게 전송하는 key-value 형태의 작은 데이터 파일

클라이언트가 서버에 요청할 때마다 쿠키가 요청에 담겨진다.  
(쿠키에 담긴 데이터를 통해 서버는 클라이언트의 상태를 알 수 있다)

---

## 쿠키의 설정

쿠키를 관리하는 것은 서버가 아닌 클라이언트(웹브라우저)이다.

따라서 쿠키가 어떻게 설정되냐에 따라서,  
웹브라우저가 요청에 쿠키를 담을지 말지 결정한다.

### 세션 쿠키, 영구 쿠키

세션 쿠키: 브라우저가 닫히면 삭제

> 여기서 브라우저가 닫힌다는 것은,  
> 탭을 닫는 것이 아니라  
> 브라우저 프로그램을 종료하는 것을 말한다.

영구 쿠키: 브라우저가 닫혀도 삭제되지 않음

세션 쿠키를 설정하는 방법: setMaxAge(-1) - or 설정을 하지 않으면 세션 쿠키가 된다.  
영구 쿠키를 설정하는 방법: setMaxAge() - 직접 만료 시간을 설정

---

### 도메인(Domain)

쿠키가 전송될 도메인을 지정한다.  
도메인이 지정되지 않은 경우 쿠키를 생성한 서버의 도메인이 기본값으로 설정된다.

---

### 경로(Path)

쿠키가 전송될 요청 경로를 지정한다.
이 경로(또는 하위 경로)에 있는 페이지에 접근할 때만
쿠키가 전송된다.

---

### 보안(Secure)

이 속성이 설정되면, HTTPS 프로토콜을 사용하는 경우에만 쿠키가 전송된다.

---

### HttpOnly

이 속성이 설정되면, 자바스크립트를 통해 쿠키에 접근할 수 없다.  
(쿠키는 HTTP(S) 요청을 통해서만 전송된다)

> XSS 공격을 막기 위해 사용한다.

---

### SameSite

이 속성은 쿠키가 다른 도메인의 요청과 함께 전송되는 방법을 제어한다.

- Strict: SameSite 속성이 설정된 쿠키는,  
  동일한 사이트에서만 사용되도록 한다.  
  (다른 도메인으로의 요청에는 쿠키가 전송되지 않는다)
- Lax: SameSite 속성이 설정된 쿠키는,  
  동일한 사이트에서만 사용되도록 한다.  
  하지만, a 태그 등을 통한 하이퍼링크를 통해 접근할 때는 쿠키가 전송된다.
- None: SameSite 속성이 설정된 쿠키는,  
  다른 도메인으로의 요청에도 쿠키가 전송된다.

> 쿠키의 Domain 속성은 포트 번호를 포함하지 않는다.  
> 
> 그래서 로컬에서의 프론트와 백 테스트는 포트 번호가 다르더라도,  
> 동일한 도메인으로 간주된다.

> SameSite 속성이 None으로 설정되면,  
> Secure 속성이 반드시 설정되어야 한다.  
> (그래야 웹브라우저가 요청에 쿠키를 담아준다)

> WAS에서 쿠키의 SameSite 속성을 설정하지 않으면,  
> 웹브라우저의 기본 설정에 따라 쿠키가 전송되지 않을 수 있다.  
> (대부분 Lax로 설정되어 있음)

---

## withCredentials

이 값은 요청을 보낼 때,  
쿠키와 인증 헤더를 함께 보내는지 여부를 결정한다.  
(인증 헤더: Authorization)

프론트는, axios에서 기본 설정으로 쿠키를 전송하지 않는다.  
(기본 설정으로 withCredentials=false)  

쿠키를 전송하려면, withCredentials=true로 설정해야 한다.

그리고 백엔드 서버에서는  
`Access-Control-Allow-Credentials: true` 헤더를 설정해야 한다.

