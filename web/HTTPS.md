# HTTPS(HTTP + SSL)

웹 브라우저와 웹 사이트 간에 데이터를 전송하는 데 사용되는 기본 프로토콜인 HTTP의 보안 버전

> HTTPS는 데이터 전송의 보안을 강화하기 위해 암호화된다.

## HTTPS 사용 이유

1. 보안(데이터가 암호화 되어 있어서, 외부에서 알 수 없다)
2. 검색엔진 최적화(구글 검색 엔진은 HTTPS에 가산점을 준다 -> 웹사이트가 더 많이 노출된다)

## SSL/TLS

SSL: Secure Sockets Layer(보안 소켓 계층)  
넷스케이프에서, 웹 서버와 웹 브라우저 간의 보안을 위해 만든 프로토콜  
SSL은 대칭키, 비대칭키 방식을 혼합해서 사용한다.

TLS: Transport Layer Security(전송 계층 보안)  
응용 계층 데이터의 암호화,  
암호화 된 전송 계층 데이터의 복호화  
TCP 443번 포트를 이용한다.

> SSL은 넷스케이프 회사의 기술이다.  
> 이를 인터넷과 관련된 기술을 표준화하는 IETF라는 기관에서  
> TLS라는 이름으로 출시했다.

### 대칭 암호화 방식

암호화와 복호화를 같은 키로 수행한다.

대칭키를 외부 사용자에게 탈취 당할 위험이 있다.

### 비대칭 암호화 방식

암호화와 복호화를 다른 키로 수행한다.  
(공개키/개인키)

공개키는 외부에 공개되도 상관없는 키다.  
개인키는 개인만이 소유하고 있는 키다.

보안과 부인 방지 기능이 있다.

> 보안: 공개키로 암호화한 데이터는 오직 개인키로만 복호화 할 수 있다  
> 부인 방지: 공개키로 복호화 했다는 것 -> 해당 데이터가 특정 개인키로 암호화 됐다 -> 해당 데이터의 소유자가 누구인지 알 수 있다

---

비대칭 암호화 방식은 대칭 암호화 방식과 다르게 개인키를 탈취 당할 걱정이 없다.
하지만 대칭 암호화 방식에 비해 암호화/복호화 과정이 느리다는 단점이 있다.

> SSL/TLS 는 대칭 암호화 방식과 비대칭 암호화 방식을 모두 사용해,  
> 각 방식의 단점을 상쇄 했다고 볼 수 있다.
> 
> (대칭 암호화 방식을 이용해 대칭키를 교환 & 대칭키로 데이터 암호화/복호화)

### TLS Handshake 과정

> TLS Handshake의 목표
> 1. 데이터를 암호화/복호화 할 대칭키 공유
> 2. 상대 서버가 신뢰 할만한 서버인지 인증 필요 -> CA의 인증서

클라이언트가 임의의 데이터를 생성해서 서버에 보낸다.

데이터를 받은 서버는, 서버측에서 생성한 임의의 데이터를 클라이언트에게 보낸다.  
그리고 해당 서버의 인증서를 실어 보낸다.

> 서버는 CA로부터 인증을 받기 위해 (서버가 유효한 서버임을 증명하기 위해)  
> 인증서를 받아야 한다.
>
> CA로부터 인증서 받는 과정
> 1. 사이트 정보 & 서버의 공개키 를 CA에 전달
> 2. CA는 전달받은 정보 검증 & CA의 개인키로 암호화 (서몀)
> 3. 암호화한 인증서를 서버에게 전달 & 브라우저에게 CA의 공개키 전달
>
> -> 서버가 클라이언트에게 인증서를 전달하면, 브라우저에 저장된 CA의 공개키로 인증서를 복호화 할 수 있다.

이제 클라이언트는 받은 인증서가 진짜인지 (브라우저에 내장된) CA의 정보를 통해 확인한다.  
(비대칭키 시스템 활용)  
CA의 인증서는 해당 CA의 개인키로 암호화 되어 있다.  
-> 브라우저에 저장된 CA의 공개키로 복호화 할 수 있다.

성공적으로 복호화된 인증서에는 상대 서버의 공개키가 포함되어 있다.

클라이언트는 맨처음 있던 임의의 데이터(클라 + 서버)를 이용해 대칭키를 만든다.  
(서버의 공개 키로 암호화)
그리고 이 대칭키를 서버의 공개키를 이용해 암호화 하고, 서버에 보낸다.

서버는 암호화된 대칭키를 자신의 개인키를 이용해 복호화 한다.  
그리고 클라이언트에게 승인 메시지를 보낸다.

이로써 브라우저와 웹 서버 모두 동일한 대칭키를 이용해 메시지를 안전하게 교환할 수 있다.

> Handshake 간단 정리
> 1. 클라이언트가 임의의 문자열 서버로 전송
> 2. 서버가 임의의 문자열 + 인증서 클라에게 전송
> 3. 클라는 CA의 공개키를 이용해 인증서 복호화 -> 서버의 공개키 획득
> 4. 클라가 임의의 문자열과 서버의 공개키를 이용해 대칭키 생성 & 서버에게 보냄
> 5. 서버는 자신의 개인키를 통해 복호화 -> 대칭키 얻음 & 클라에게 승인 메시지 보냄

---

### 세션키

TLS Handshake로 생성된 대칭키를 세션키라고도 부른다.

이 세션키는 해당 세션에서만 사용되고,  
세션이 종료되면 세션키를 버린다.

(만약 새로운 세션을 연결한다면, 새로운 세션키를 생성한다)

---

> TLS 1.3 Handshake
>
> 기존 Handshake 과정은 2 RTT가 소요되는데, 1.3 버전의 Handshake 과정은 1 RTT만 소요된다.

