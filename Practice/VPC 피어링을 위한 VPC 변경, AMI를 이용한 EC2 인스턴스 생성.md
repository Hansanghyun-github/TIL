### 문제 발생 - AWS Data Transfer 요금 왜 나옴?

-> public IP를 이용해서 EC2끼리 통신하면 데이터 통신한 만큼 요금 나온다고 한다.  
(지역, AZ 같더라도)

> 데이터 통신을 public IP를 이용한 이유  
> -> 어떻게든 요금 아끼려고 프리티어 다계정을 이용해 EC2 인스턴스 여러개 썼다.  
> (dev, monitoring, test 계정들)

-> VPC peering을 이용하면 요금을 없앨 수 있다고 한다.  
(이걸 쓰면 public IP가 아닌 private IP로 통신 가능하다)

### VPC 피어링을 위한 CIDR 설정

그런데 VPC peering을 하려면 CIDR이 달라야 한다고 한다.  
(CIDR: 서브넷팅을 위해(IP 주소 효율적으로 사용하기 위해))

> 문제는 나는 EC2 만들때 VPC 설정을 기본으로 해서, 각각의 계정들의 인스턴스의 VPC CIDR이 다 같았다.

결국 새로 VPC를 생성해야 했다.

---

### VPC 피어링

새로 VPC를 생성하고, VPC 피어링을 했다.

---

그런데 EC2 인스턴스는 중간에 VPC를 변경할 수 없다.

-> 그럼 내가 깔아놓은 프로그램들은 어떻게 되나?  
-> EC2 AMI을 이용하면 그대로 복사해서 EC2 생성할 수 있다고 한다.

---

### AMI(Amazon Machine Images)

EC2 인스턴스 생성에 필요한 소프트웨어 구성(예: 운영 체제, 애플리케이션 서버 및 애플리케이션)이 포함되어 있다.

맨 처음 인스턴스를 생성하기 위해 이를 지정해줘야 한다.  
(내가 아무것도 모르고 지정한 AMI는 AWS에서 기본적으로 제공하는 AMI(우분투, 리눅스, 레드햇 등등 기본 AMI가 있다))

그래서 인스턴스의 AMI를 생성했다.

(AMI는 EBS나 S3에 저장된다)

> AMI에 포함되는 것들 - 내가 설치한 프로그램들, 인스턴스 정보(VPC 등등)  
> AMI에 포함 안되는 것들 - 가상메모리, 프로세스 등 런타임과 관련된 정보들

그래서 생성한 AMI를 이용해 그대로 같은 인스턴스를 VPC만 바꿔서 생성했다.

---

### 새로운 EC2 스왑 영역 설정

기존 EC2에서는 /swapfile 파일을 생성하고 이를 이용해 스왑 영역을 설정했다.

이떄 ami를 이용해 복제했을 떄,  
/swapfile은 남아있지만,  
이를 이용한 스왑 영역 설정은 사라진다.

> AMI는 런타임과 관련된 정보들은 포함하지 않기 때문이다.

남아있는 /swapfile 파일을 이용해 스왑 영역을 설정했다.

---

