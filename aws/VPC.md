# VPC(Virtual Private Cloud)

## 정의

AWS 클라우드에서 사용자가 정의하는 가상 네트워크이다.  

사용자는 VPC를 이용해  
여러 인스턴스들을 논리적으로 그룹화하고,  
AWS 리소스들과 안전하게 연결할 수 있다.

이를 통해 보안, 라우팅, 네트워킹 등을 제어할 수 있다.

> VPC가 없다면 EC2 인스턴스들이 연결되어 있지 않기 때문에,  
> private IP를 이용해 통신할 수 없다.  
> 또한 보안, 라우팅, 네트워킹 등을 제어할 수 없다.

> 각각의 VPC는 완전히 독립된 네트워크처럼 작동한다.

---

## VPC 구축

> VPC는 하나의 리전에만 속할 수 있다.

### IP 주소 범위 정의

VPC를 구축하려면 VPC의 IP 주소 범위를 정의해야 한다.

VPC의 IP 주소 범위는 CIDR(Classless Inter-Domain Routing) 블록으로 정의된다.

### 서브넷 생성

서브넷은 VPC를 더 작은 네트워크로 분할하는 것이다.

> 서브넷은 VPC보다 더 작은 단위이기 때문에,  
> VPC의 CIDR 범위 내에 있어야 한다.  
> (CIDR의 프리픽스 길이가 VPC 보다 길어야 한다)

서브넷은 다음과 같은 것들을 정의해야 한다.
- CIDR 블록
- 가용 영역
- 라우팅 테이블
- 네트워크 ACL
- 서브넷의 보안 그룹

---

## VPC 관련 용어들

### 라우팅 테이블과 라우터

VPC에 속한 특정 EC2 인스턴스에서 네트워크 요청이 발생하면,  
데이터는 우선 라우터로 전송된다.

라우터는 라우팅 테이블을 참조해 데이터를 목적지로 전송한다.

이때 VPC 내부가 아닌 외부로 데이터를 전송할 때는  
인터넷 게이트웨이를 사용한다.

### 인터넷 게이트웨이(IGW - Internet Gateway)

VPC와 인터넷 간의 통신을 가능하게 하는 관문이다.

### 네트워크 ACL과 보안 그룹

네트워크 ACL과 보안 그룹은 VPC의 보안을 제어하는 도구이다.
(인바운드, 아웃바운드 트래픽을 제어할 수 있다)

네트워크 ACL은 서브넷에 대한 트래픽을 제어한다.  
(기본 설정으로 모든 트래픽을 허용한다)

보안 그룹은 EC2 인스턴스 등 리소스에 대한 트래픽을 제어한다.  
(기본 설정으로 모든 트래픽을 거부한다 (인바운드만))

> 네트워크 ACL과 보안 그룹이 충돌한다면,  
> 보안 그룹이 우선순위를 가진다.

### NAT 게이트웨이

NAT 게이트웨이는 VPC 내부의 인스턴스들이  
(private 서브넷에 속한 인스턴스들이)  
인터넷에 접근할 수 있게 해준다.

퍼블릭 서브넷상에서 동작하는 NAT 게이트웨이는  
private 서브넷에서 외부로 요청하는 아웃바운드 트래픽을 받아 IGW와 연결한다.

> private 인스턴스들은 주기적인 업데이트를 위해  
> 아웃바운드 트래픽이 허용될 필요가 있다.

---

## VPC 피어링

VPC 피어링은 두 개의 VPC를 연결하는 것이다.  
(서로 다른 계정의 VPC도 연결할 수 있다)

### VPC 피어링의 특징

두 VPC의 IP 주소 범위가 겹치지 않아야 한다.  
(CIDR 블록이 겹치면 연결할 수 없다)