# TLS 인증서 체인 구조

## 핵심 개념: 서명 vs 암호화

인증서 전체가 암호화된 것이 아니다. 인증서 데이터는 평문이고, 서명(Signature)만 암호화되어 있다.

### 인증서 구조

```
┌─────────────────────────────────┐
│         인증서                   │
├─────────────────────────────────┤
│  데이터 (평문)                   │
│    - 도메인, 공개키, 유효기간 등  │
├─────────────────────────────────┤
│  서명                            │
│    Hash(데이터)를                │
│    발급자 개인키로 암호화한 값    │
└─────────────────────────────────┘
```

### 서명 검증 과정

1. 발급자의 공개키로 서명을 복호화 → Hash 값 획득
2. 인증서 데이터를 직접 해싱 → Hash 값 생성
3. 두 Hash 비교 → 일치하면 검증 성공

## 인증서 체인 (Chain of Trust)

```
Root CA 인증서 (브라우저/OS에 내장)
    │
    │ Root CA 개인키로 서명
    ▼
Intermediate CA 인증서
    │
    │ Intermediate CA 개인키로 서명
    ▼
서버 인증서
```

### 각 인증서의 역할

| 인증서 | 포함된 공개키 | 서명한 주체 | 검증에 필요한 공개키 |
|--------|--------------|------------|-------------------|
| 서버 인증서 | 서버 공개키 | Intermediate CA | Intermediate CA 공개키 |
| Intermediate CA | Intermediate 공개키 | Root CA | Root CA 공개키 |
| Root CA | Root CA 공개키 | 자기 자신 | (자기 서명) |

## Root CA와 Intermediate CA를 분리하는 이유

Root CA는 너무 중요해서 직접 사용하지 않는다.

- Root CA 개인키: 오프라인 금고에 보관, 거의 사용 안함
- Intermediate CA 개인키: 온라인 서버에서 인증서 발급에 사용

만약 Intermediate CA가 유출되면 해당 CA만 폐기(CRL/OCSP)하고 새로 발급하면 된다. 하지만 Root CA가 유출되면 전세계 브라우저 업데이트가 필요하다.

## TLS Handshake 시 서버가 전송하는 것

```
서버 → 클라이언트:
  1. 서버 인증서 (필수)
  2. Intermediate CA 인증서 (필수)
  3. Root CA 인증서 (선택)

※ Root CA는 클라이언트가 이미 보유하고 있어 보통 생략
```

## 사설 인증서 (Self-signed)

자기 자신의 개인키로 서명한 인증서. Root CA, Intermediate CA 체인이 없다.

- 브라우저가 기본적으로 신뢰하지 않음
- 클라이언트에 직접 인증서를 설치해야 함
- 또는 "신뢰할 수 없는 인증서" 경고를 무시해야 함

## 요약

- 인증서 데이터: 평문
- 서명: 발급자 개인키로 암호화된 Hash
- 검증: 발급자 공개키로 서명 복호화 후 Hash 비교
- Root CA: 브라우저에 내장, 직접 사용 안함 (보안상 이유)
- Intermediate CA: 실제 인증서 발급 담당
- 사설 인증서: Self-signed, 별도 설치 필요
